version: '2.4'
services:
    lxknstest:
        build:
            context: ../..
            dockerfile: test/ci-test-image/Dockerfile
        pid: host
        cap_drop:
            - ALL
        cap_add: 
            - CAP_SYS_ADMIN  # for switching namespaces in general
            - CAP_SYS_CHROOT # for switching mnt namespaces
            - CAP_SYS_PTRACE # for reading /proc/$PID/ns/*
            - CAP_SETGID     # only for runtests to su down into ordinary user
            - CAP_SETUID     # only for runtests to su down into ordinary user
        security_opt: 
            - apparmor:unconfined
